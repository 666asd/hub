version: '3.4'
# Starting with the 2019.2.0 release: DO NOT EDIT THIS FILE!!!
# ADD ANY OF YOUR OVERRIDES IN THE docker-compose.local-overrides.yml FILE
# Refer to the Release Notes or Installation Guide for more information.

services:
  uploadcache:
    image: blackducksoftware/blackduck-upload-cache:1.0.3
    tmpfs: [/opt/blackduck/hub/blackduck-upload-cache/security]
    volumes: ['uploadcache-volume:/opt/blackduck/hub/hub-upload-cache/uploads']
    healthcheck:
      test: [CMD, curl, --insecure, -X, GET, --verbose, 'http://localhost:8086/live?full=1']
      interval: 30s
      timeout: 10s
      retries: 5
    user: uploadcache:root
    env_file: [hub-bdba.env]
    deploy:
      mode: replicated
      restart_policy: {condition: on-failure, delay: 5s, window: 60s}
      resources:
        limits: {memory: 512M}
        reservations: {memory: 512M}
  binaryscanner:
    image: blackducksoftware/appcheck-worker:1.0.1
    env_file: [hub-bdba.env]
    command: /docker-entrypoint.sh
    deploy:
      mode: replicated
      restart_policy: {condition: on-failure, delay: 5s, window: 60s}
      resources:
        limits: {memory: 2048M, cpus: '1'}
        reservations: {memory: 2048M, cpus: '1'}
  rabbitmq:
    image: blackducksoftware/rabbitmq:1.0.0
    depends_on: [cfssl]
    tmpfs: [/opt/blackduck/rabbitmq/security]
    volumes: ['rabbitmq-data-volume:/var/lib/rabbitmq']
    env_file: [hub-bdba.env]
    user: rabbitmq:root
    deploy:
      mode: replicated
      restart_policy: {condition: on-failure, delay: 5s, window: 60s}
      resources:
        limits: {memory: 1024M}
        reservations: {memory: 1024M}
volumes: {postgres96-data-volume: null, authentication-volume: null, cert-volume: null,
  config-volume: null, log-volume: null, webapp-volume: null, solr6-volume: null,
  monitor-log-volume: null, zookeeper-data-volume: null, zookeeper-datalog-volume: null,
  uploadcache-volume: null, rabbitmq-data-volume: null}
